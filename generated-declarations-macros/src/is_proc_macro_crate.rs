fn is_proc_macro_crate (crate_root : & Path) -> Result < bool > { let cargo_toml_path = crate_root . join ("Cargo.toml") ; if ! cargo_toml_path . exists () { return Ok (false) ; } let content = fs :: read_to_string (& cargo_toml_path) . context (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("Failed to read Cargo.toml for {0}" , crate_root . display () ,) ,) }) ,) ? ; let cargo_toml : CargoToml = toml :: from_str (& content) . context (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("Failed to parse Cargo.toml for {0}" , crate_root . display () ,) ,) }) ,) ? ; Ok (cargo_toml . lib . map_or (false , | lib | lib . proc_macro)) }