use prelude::*;
fn main () -> Result < () > { measurement :: record_function_entry (stringify ! (main)) ; let __result = { let args = Args :: parse () ; println ! ("Discovering Rust files in workspace root: {:?}" , args . workspace_root) ; let rust_files : Vec < PathBuf > = WalkDir :: new (& args . workspace_root) . into_iter () . filter_map (| e | e . ok ()) . filter (| entry | { entry . file_type () . is_file () && entry . path () . extension () . map_or (false , | ext | ext == "rs") && ! entry . path () . to_string_lossy () . contains ("target/") && ! entry . path () . to_string_lossy () . contains (".gemini/generated/") }) . map (| entry | entry . path () . to_path_buf ()) . collect () ; if rust_files . is_empty () { println ! ("No Rust files found in {:?}" , args . workspace_root) ; return Ok (()) ; } for file_path in rust_files { println ! ("Running prelude-generator for file: {:?}" , file_path) ; let mut prelude_cmd = Command :: new ("cargo") ; prelude_cmd . arg ("run") . arg ("-p") . arg ("prelude-generator") . arg ("--") . arg ("--file") . arg (& file_path) . arg ("--run-pipeline") ; if args . dry_run { prelude_cmd . arg ("--dry-run") ; } let prelude_output = prelude_cmd . output () . context (format ! ("Failed to execute prelude-generator for {:?}" , file_path)) ? ; if ! prelude_output . status . success () { anyhow :: bail ! ("prelude-generator failed for {:?}: {}\n{}" , file_path , String :: from_utf8_lossy (& prelude_output . stdout) , String :: from_utf8_lossy (& prelude_output . stderr)) ; } println ! ("prelude-generator output for {:?}:\n{}" , file_path , String :: from_utf8_lossy (& prelude_output . stdout)) ; eprintln ! ("prelude-generator errors for {:?}:\n{}" , file_path , String :: from_utf8_lossy (& prelude_output . stderr)) ; } println ! ("\nRunning rust-decl-splitter...") ; let mut splitter_cmd = Command :: new ("cargo") ; splitter_cmd . arg ("run") . arg ("-p") . arg ("rust-decl-splitter") . arg ("--") . arg (& args . input_dir) . arg (& args . output_dir) ; let splitter_output = splitter_cmd . output () . context ("Failed to execute rust-decl-splitter") ? ; if ! splitter_output . status . success () { anyhow :: bail ! ("rust-decl-splitter failed: {}\n{}" , String :: from_utf8_lossy (& splitter_output . stdout) , String :: from_utf8_lossy (& splitter_output . stderr)) ; } println ! ("rust-decl-splitter output:\n{}" , String :: from_utf8_lossy (& splitter_output . stdout)) ; eprintln ! ("rust-decl-splitter errors:\n{}" , String :: from_utf8_lossy (& splitter_output . stderr)) ; println ! ("\nSystem composition complete.") ; Ok (()) } ; measurement :: record_function_exit (stringify ! (main)) ; __result }