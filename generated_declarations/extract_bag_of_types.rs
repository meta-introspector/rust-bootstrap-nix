pub async fn extract_bag_of_types (project_root : & PathBuf , filter_names : & Option < Vec < String > > ,) -> Result < HashMap < String , TypeInfo > > { let mut type_map : HashMap < String , TypeInfo > = HashMap :: new () ; for entry in WalkDir :: new (project_root) . into_iter () . filter_map (| e | e . ok ()) . filter (| e | { e . file_type () . is_file () && e . path () . extension () . map_or (false , | ext | ext == "rs") }) . filter (| e | { if let Some (names) = filter_names { names . iter () . any (| name | e . file_name () . to_string_lossy () . contains (name)) } else { true } }) { let path = entry . path () ; let content = match std :: fs :: read_to_string (& path) { Ok (c) => c , Err (e) => { { :: std :: io :: _eprint (format_args ! ("Error reading file {0}: {1:?}\n" , path . display () , e ,) ,) ; } ; continue ; } } ; let file = match syn :: parse_file (& content) { Ok (f) => f , Err (e) => { { :: std :: io :: _eprint (format_args ! ("Warning: Could not parse file {0}: {1:?}\n" , path . display () , e ,) ,) ; } ; continue ; } } ; let mut collector = TypeCollector { type_map : & mut type_map , } ; collector . visit_file (& file) ; } Ok (type_map) }