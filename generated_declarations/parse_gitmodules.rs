# [doc = " Returns the submodule paths from the `.gitmodules` file in the given directory."] pub fn parse_gitmodules (target_dir : & Path) -> & [String] { static SUBMODULES_PATHS : OnceLock < Vec < String > > = OnceLock :: new () ; let gitmodules = target_dir . join (".gitmodules") ; if ! gitmodules . exists () { { :: core :: panicking :: panic_fmt (format_args ! ("\'{0}\' file is missing." , gitmodules . display ()) ,) ; } } let init_submodules_paths = | | { let file = File :: open (gitmodules) . unwrap () ; let mut submodules_paths = :: alloc :: vec :: Vec :: new () ; for line in BufReader :: new (file) . lines () . map_while (Result :: ok) { let line = line . trim () ; if line . starts_with ("path") { let actual_path = line . split (' ') . last () . expect ("Couldn't get value of path") ; submodules_paths . push (actual_path . to_owned ()) ; } } submodules_paths } ; SUBMODULES_PATHS . get_or_init (| | init_submodules_paths ()) }