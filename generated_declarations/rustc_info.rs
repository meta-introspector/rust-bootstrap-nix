pub mod rustc_info { use anyhow :: Result ; use std :: process :: Command ; pub struct RustcInfo { pub version : String , pub host : String , } # [automatically_derived] impl :: core :: fmt :: Debug for RustcInfo { # [inline] fn fmt (& self , f : & mut :: core :: fmt :: Formatter) -> :: core :: fmt :: Result { :: core :: fmt :: Formatter :: debug_struct_field2_finish (f , "RustcInfo" , "version" , & self . version , "host" , & & self . host ,) } } # [automatically_derived] impl :: core :: clone :: Clone for RustcInfo { # [inline] fn clone (& self) -> RustcInfo { RustcInfo { version : :: core :: clone :: Clone :: clone (& self . version) , host : :: core :: clone :: Clone :: clone (& self . host) , } } } # [automatically_derived] impl :: core :: marker :: StructuralPartialEq for RustcInfo { } # [automatically_derived] impl :: core :: cmp :: PartialEq for RustcInfo { # [inline] fn eq (& self , other : & RustcInfo) -> bool { self . version == other . version && self . host == other . host } } # [automatically_derived] impl :: core :: cmp :: Eq for RustcInfo { # [inline] # [doc (hidden)] # [coverage (off)] fn assert_receiver_is_total_eq (& self) -> () { let _ : :: core :: cmp :: AssertParamIsEq < String > ; } } # [automatically_derived] impl :: core :: hash :: Hash for RustcInfo { # [inline] fn hash < __H : :: core :: hash :: Hasher > (& self , state : & mut __H) -> () { :: core :: hash :: Hash :: hash (& self . version , state) ; :: core :: hash :: Hash :: hash (& self . host , state) } } pub fn get_rustc_info () -> Result < RustcInfo > { let output = Command :: new ("rustc") . arg ("--version") . arg ("--verbose") . output () ? ; if ! output . status . success () { return :: anyhow :: __private :: Err (:: anyhow :: Error :: msg (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("rustc --version --verbose failed: {0}" , String :: from_utf8_lossy (& output . stderr) ,) ,) }) ,) ,) ; } let stdout = String :: from_utf8_lossy (& output . stdout) ; let version_line = stdout . lines () . find (| line | line . starts_with ("rustc ")) ; let host_line = stdout . lines () . find (| line | line . starts_with ("host: ")) ; let version = version_line . and_then (| line | line . split_whitespace () . nth (1)) . unwrap_or ("unknown") . to_string () ; let host = host_line . and_then (| line | line . split_whitespace () . nth (1)) . unwrap_or ("unknown") . to_string () ; Ok (RustcInfo { version , host }) } }