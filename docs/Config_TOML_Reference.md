# config.toml Reference

This document provides a comprehensive reference for all configurable options within the `config.toml` file used by the `rust-bootstrap-nix` project. This file is central to defining the build environment, toolchain paths, and various build-time behaviors.

## Overview

The `config.toml` file is generated by the `bootstrap-config-builder` tool, which can take inputs from command-line arguments or a base configuration file. It allows for fine-grained control over the Rust bootstrap process, ensuring reproducibility and adaptability across different environments, especially within Nix.

## Sections and Options

### `[nix]` Section

This section defines paths and references related to the Nix ecosystem.

*   `nixpkgs_path` (Path): The absolute path to the `nixpkgs` source.
    *   **Purpose:** Specifies the version and location of the Nix Packages collection to be used for dependencies.
    *   **Example:** `nixpkgs_path = "/nix/store/...-nixpkgs"`

*   `rust_overlay_path` (Path): The absolute path to the Rust overlay source.
    *   **Purpose:** Specifies the location of a custom Nix overlay for Rust, which might contain specialized Rust toolchains or packages.
    *   **Example:** `rust_overlay_path = "/nix/store/...-rust-overlay"`

*   `rust_bootstrap_nix_path` (Path): The absolute path to the `rust-bootstrap-nix` project root.
    *   **Purpose:** Defines the root directory of the current project, used for resolving relative paths.

*   `configuration_nix_path` (Path): The absolute path to the `configuration-nix` source.
    *   **Purpose:** Specifies the location of the `configuration-nix` flake, which might be used for generating additional configuration.

*   `rust_src_flake_path` (Path): The absolute path to the `rust-src` flake source.
    *   **Purpose:** Points to the source code of the Rust compiler, which is a foundational input for the bootstrap process.

*   `rust_bootstrap_nix_flake_ref` (String): The flake reference for `rust-bootstrap-nix`.
    *   **Purpose:** Specifies the Git reference (e.g., branch, tag, commit hash) for the `rust-bootstrap-nix` flake input.
    *   **Example:** `rust_bootstrap_nix_flake_ref = "github:meta-introspector/rust-bootstrap-nix?ref=main"`

*   `rust_src_flake_ref` (String): The flake reference for `rust-src`.
    *   **Purpose:** Specifies the Git reference for the `rust-src` flake input.
    *   **Example:** `rust_src_flake_ref = "github:meta-introspector/rust?ref=e6c1b92d0abaa3f64032d6662cbcde980c826ff2"`

### `[rust]` Section

This section configures the Rust toolchain and its behavior.

*   `rustc` (Path): The absolute path to the `rustc` (Rust compiler) executable.
    *   **Purpose:** Ensures that the build uses a precisely defined and versioned compiler.
    *   **Example:** `rustc = "/nix/store/.../bin/rustc"`

*   `cargo` (Path): The absolute path to the `cargo` (Rust package manager) executable.
    *   **Purpose:** Guarantees the use of a specific, Nix-managed `cargo` instance.
    *   **Example:** `cargo = "/nix/store/.../bin/cargo"`

*   `channel` (String): The Rust release channel to use.
    *   **Purpose:** Specifies whether to use `stable`, `beta`, or `nightly` Rust toolchains.
    *   **Default:** `stable`
    *   **Example:** `channel = "nightly"`

*   `download-rustc` (Boolean): Whether to download `rustc`.
    *   **Purpose:** Controls if the `rustc` compiler should be downloaded or if an existing one should be used.
    *   **Default:** `false`

*   `parallel-compiler` (Boolean): Whether to enable parallel compilation.
    *   **Purpose:** Optimizes build times by allowing `rustc` to compile multiple crates in parallel.
    *   **Default:** `false`

*   `llvm-tools` (Boolean): Whether to enable LLVM tools.
    *   **Purpose:** Includes LLVM utilities in the build, which might be required for certain Rust features or targets.
    *   **Default:** `false`

*   `debuginfo-level` (Integer): The debug information level for Rust compilation.
    *   **Purpose:** Controls the amount of debug information generated, affecting binary size and debuggability.
    *   **Default:** `0` (no debug info)
    *   **Example:** `debuginfo-level = 1`

### `[build]` Section

This section defines general build-related settings.

*   `stage` (String): The build stage to configure.
    *   **Purpose:** Used in multi-stage build processes to specify which stage is being targeted (e.g., "0", "1", "2").

*   `target` (String): The target triple for the build.
    *   **Purpose:** Specifies the architecture, vendor, operating system, and ABI for which the code is being compiled.
    *   **Example:** `target = "aarch64-unknown-linux-gnu"`

*   `patch-binaries-for-nix` (Boolean): Enables Nix-specific patching of binaries.
    *   **Purpose:** Essential for ensuring that compiled artifacts are relocatable within the Nix store, often involving adjustments to RPATHs.
    *   **Default:** `false`

*   `vendor` (Boolean): Enables vendoring for the Rust build process.
    *   **Purpose:** Ensures that dependencies are present locally (e.g., in a `vendor/` directory) rather than being downloaded during the build, crucial for reproducible Nix builds.
    *   **Default:** `false`

*   `build-dir` (Path): The directory where build artifacts are placed.
    *   **Purpose:** Overrides the default build output directory.

*   `jobs` (Integer): The number of parallel build jobs.
    *   **Purpose:** Controls the concurrency of the build process, often set to the number of CPU cores.
    *   **Default:** `0` (auto-detect)

### `[env]` Section

This section defines environment variables for the build process.

*   `HOME` (Path): The `HOME` directory for the build.
    *   **Purpose:** Sets the `HOME` environment variable to a temporary, isolated directory to prevent pollution of the user's actual home directory.

*   `CARGO_HOME` (Path): The `CARGO_HOME` directory for the build.
    *   **Purpose:** Ensures that Cargo's caches, registries, and other state are kept isolated within the build environment.

### `[install]` Section

This section controls where the built artifacts will be placed.

*   `prefix` (Path): The base directory for all installed components.
    *   **Purpose:** In a Nix environment, this will typically be a path within the Nix store. All other installation paths (like `bindir`, `libdir`, etc.) will be derived from this prefix unless explicitly overridden.
    *   **Example:** `prefix = "/nix/store/some-hash-my-rust-package"`

*   `sysconfdir` (Path): The directory for system-wide configuration files.
    *   **Purpose:** Specifies where configuration files should be installed.

### `[dist]` Section

This section configures distribution-related settings.

*   `sign-folder` (Path): The folder for distribution signing.
    *   **Purpose:** Specifies the directory where distribution artifacts are signed.

*   `upload-addr` (String): The upload address for distribution.
    *   **Purpose:** Defines the target address for uploading built distributions.

### `[llvm]` Section

This section configures LLVM-related settings.

*   `download-ci-llvm` (Boolean): Whether to download CI LLVM.
    *   **Purpose:** Controls if LLVM components from continuous integration should be downloaded.
    *   **Default:** `false`

*   `ninja` (Boolean): Whether to use Ninja for LLVM builds.
    *   **Purpose:** Specifies if the Ninja build system should be used for compiling LLVM.
    *   **Default:** `false`

### `[target.<triple>]` Section (Example)

This is an example of a target-specific section, where `<triple>` would be a target triple like `aarch64-unknown-linux-gnu`.

*   `cc` (Path): The path to the C compiler for this target.
    *   **Purpose:** Allows specifying a custom C compiler for a particular target.

*   `android-ndk` (Path): The path to the Android NDK for this target.
    *   **Purpose:** Specifies the Android NDK location when building for Android targets.

### `[change-id]` Section

This section is used for tracking major changes in the configuration.

*   `id` (String): A unique identifier for tracking configuration changes.
    *   **Purpose:** Helps in identifying and managing different versions or significant modifications of the `config.toml`.
