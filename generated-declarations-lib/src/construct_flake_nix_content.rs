# [doc = " Constructs the content of the flake.nix file."] fn construct_flake_nix_content (project_root : & Path , metadata : & Metadata , config : & FlakeGeneratorConfig ,) -> Result < String > { let root_manifest_path = project_root . join ("Cargo.toml") ; let root_package = metadata . packages . iter () . find (| p | p . manifest_path == root_manifest_path) . ok_or_else (| | :: anyhow :: Error :: msg (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("Could not find package for manifest path: {0}" , root_manifest_path . display () ,) ,) }) ,)) ? ; let package_name = & root_package . name ; let package_version = & root_package . version ; let content = :: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("\n{{\n  description = \"Nix flake for Rust package: {0}\";\n\n  inputs = {{\n    nixpkgs.url = \"{1}\";\n    rust-overlay.url = \"{2}\";\n    flake-utils.url = \"github:numtide/flake-utils\";\n  }};\n\n  outputs = {{ self, nixpkgs, rust-overlay, flake-utils }}:\n    flake-utils.lib.eachDefaultSystem (system:\n      let\n        pkgs = import nixpkgs {{\n          inherit system;\n          overlays = [ rust-overlay.overlays.default ];\n        }};\n        rustToolchain = pkgs.rust-bin.fromRustupToolchainFile {{\n          rustToolchainFile = ./rust-toolchain.toml; # Assuming rust-toolchain.toml exists\n        }};\n      in\n      {{\n        packages.{3} = pkgs.rustPlatform.buildRustPackage {{\n          pname = \"{4}\";\n          version = \"{5}\";\n          src = ./.;\n          cargoLock.lockFile = ./Cargo.lock; # Assuming Cargo.lock exists\n\n          nativeBuildInputs = with pkgs; [\n            pkg-config\n          ];\n\n          buildInputs = with pkgs; [\n            # Add common build dependencies here, e.g., openssl\n            # openssl\n          ];\n\n          # Environment variables for build, if needed\n          # OPENSSL_LIB_DIR = \"${{pkgs.lib.getLib pkgs.openssl}}/lib\";\n          # OPENSSL_INCLUDE_DIR = \"${{pkgs.openssl.dev}}/include\";\n          # PKG_CONFIG_PATH = \"${{pkgs.openssl.dev}}/lib/pkgconfig\";\n        }};\n      }}\n    );\n}}\n" , package_name , config . nixpkgs_url , config . rust_overlay_url , package_name , package_name , package_version ,) ,) }) ; Ok (content) }