pub async fn copy_dir_all (src : impl AsRef < Path > , dst : impl AsRef < Path > ,) -> Result < () > { fs :: create_dir_all (& dst) . await ? ; let mut stack = < [_] > :: into_vec (:: alloc :: boxed :: box_new ([src . as_ref () . to_path_buf ()]) ,) ; while let Some (current_src) = stack . pop () { let current_dst = dst . as_ref () . join (current_src . strip_prefix (src . as_ref ()) . unwrap ()) ; let mut entries = fs :: read_dir (& current_src) . await ? ; while let Some (entry) = entries . next_entry () . await ? { let entry_path = entry . path () ; let relative_path = entry_path . strip_prefix (& current_src) . unwrap () ; let destination_path = current_dst . join (relative_path) ; if entry_path . is_dir () { fs :: create_dir_all (& destination_path) . await ? ; stack . push (entry_path) ; } else { fs :: copy (& entry_path , & destination_path) . await ? ; } } } Ok (()) }