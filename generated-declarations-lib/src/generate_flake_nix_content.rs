pub fn generate_flake_nix_content (nixpkgs_url : & str , system_arch : & str , use_rustc_wrapper : bool ,) -> String { :: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("{{\n  \n  description = \"Nix flake for Rust macro expansion\";\n\n  inputs = {{\n    nixpkgs.url = \"{0}\";\n    cargo2nix.url = \"github:cargo2nix/cargo2nix/release-0.12.0\"; # Use a specific release of cargo2nix\n  }};\n\n  outputs = {{ self, nixpkgs, cargo2nix }}:\n    let\n      pkgs = import nixpkgs {{ system = \"{1}\"; }};\n      rustPkgs = pkgs.rust-bin.stable.latest.default.override {{\n        targets = [ pkgs.system ];\n      }};\n      rustcWrapper = pkgs.writeShellScript \"rustc-wrapper\" \'\'\n        echo \"$(date): rustc called with arguments: $*\" >> $out/rustc_calls.log\n        exec ${{rustPkgs}}/bin/rustc \"$@\"\n      \'\';\n      expandedCode = pkgs.runCommand \"expanded-code\" {{\n        nativeBuildInputs = [ rustPkgs ];\n        src = ./.; # The temporary directory containing Cargo.toml and src/lib.rs\n        RUSTC = rustcWrapper;\n        outputs = [ \"/expanded_code.rs\" \"/rustc_calls.log\" ];\n      }} \'\'\n        export RUSTFLAGS=\"-Zunpretty=expanded\"\n        cargo rustc --lib -- -Zunpretty=expanded > $out/expanded_code.rs\n      \'\';\n    in\n    {{\n      packages.{2}.default = expandedCode;\n    }};\n}}\n" , nixpkgs_url , system_arch , system_arch ,) ,) }) }