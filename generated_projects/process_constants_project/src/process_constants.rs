use std::collections::HashSet;
use split_expanded_lib::{DeclarationItem};

pub async fn process_constants (all_constants : Vec < syn :: ItemConst > , args : & crate :: Args , project_root : & PathBuf , all_numerical_constants : & mut Vec < syn :: ItemConst > , all_string_constants : & mut Vec < syn :: ItemConst > , _type_map : & HashMap < String , type_extractor :: TypeInfo > ,) -> anyhow :: Result < () > { let generated_decls_output_dir = args . generated_decls_output_dir . clone () . unwrap_or_else (| | { project_root . join ("generated/level0_decls") }) ; let constants_output_dir = generated_decls_output_dir . join ("constants") ; tokio :: fs :: create_dir_all (& constants_output_dir) . await . context (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("Failed to create output directory {0:?}" , constants_output_dir ,) ,) }) ,) ? ; { :: std :: io :: _print (format_args ! ("  -> Generated constants will be written to: {0:?}\n" , constants_output_dir ,) ,) ; } ; for constant in all_constants { let const_name = constant . ident . to_string () ; let file_name = :: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("{0}.rs" , const_name)) }) ; let output_path = constants_output_dir . join (& file_name) ; let content = { let mut _s = :: quote :: __private :: TokenStream :: new () ; :: quote :: ToTokens :: to_tokens (& constant , & mut _s) ; _s } . to_string () ; tokio :: fs :: write (& output_path , content . as_bytes ()) . await . context (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("Failed to write constant {0:?} to {1:?}" , const_name , output_path ,) ,) }) ,) ? ; { :: std :: io :: _print (format_args ! ("  -> Wrote constant {0:?} to {1:?}\n" , const_name , output_path ,) ,) ; } ; if let syn :: Expr :: Lit (expr_lit) = & constant . expr . as_ref () { match & expr_lit . lit { syn :: Lit :: Int (_) | syn :: Lit :: Float (_) => { all_numerical_constants . push (constant . clone ()) } syn :: Lit :: Str (_) => all_string_constants . push (constant . clone ()) , _ => { } } } } Ok (()) }