use std::collections::HashSet;
use split_expanded_lib::{DeclarationItem};

# [doc = " Compares the current Rust options against those in the CI rustc builder and detects any incompatible options."] # [doc = " It does this by destructuring the `Rust` instance to make sure every `Rust` field is covered and not missing."] pub fn check_incompatible_options_for_ci_rustc (current_config_toml : TomlConfig , ci_config_toml : TomlConfig ,) -> Result < () , String > { let (Some (current_rust_config) , Some (ci_rust_config)) = (current_config_toml . rust , ci_config_toml . rust ,) else { return Ok (()) ; } ; let Rust { optimize , randomize_layout , debug_logging , llvm_tools , llvm_bitcode_linker , lto , stack_protector , strip , lld_mode , jemalloc , rpath , channel , description , incremental , default_linker , std_features , debug : _ , codegen_units : _ , codegen_units_std : _ , rustc_debug_assertions : _ , std_debug_assertions : _ , overflow_checks : _ , overflow_checks_std : _ , backtrace : _ , parallel_compiler : _ , musl_root : _ , verbose_tests : _ , optimize_tests : _ , codegen_tests : _ , omit_git_hash : _ , dist_src : _ , save_toolstates : _ , codegen_backends : _ , lld : _ , deny_warnings : _ , backtrace_on_ice : _ , verify_llvm_ir : _ , thin_lto_import_instr_limit : _ , remap_debuginfo : _ , test_compare_mode : _ , llvm_libunwind : _ , control_flow_guard : _ , ehcont_guard : _ , new_symbol_mangling : _ , profile_generate : _ , profile_use : _ , download_rustc : _ , validate_mir_opts : _ , frame_pointers : _ , } = ci_rust_config ; if let Some (current) = & current_rust_config . optimize { if Some (current) != optimize . as_ref () { return Err (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("ERROR: Setting `rust.{0}` is incompatible with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}" , "optimize" . replace ("_" , "-") , current_rust_config . optimize , if optimize . is_some () { "None/" } else { "" } , optimize ,) ,) }) ,) ; } } if let Some (current) = & current_rust_config . randomize_layout { if Some (current) != randomize_layout . as_ref () { return Err (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("ERROR: Setting `rust.{0}` is incompatible with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}" , "randomize_layout" . replace ("_" , "-") , current_rust_config . randomize_layout , if randomize_layout . is_some () { "None/" } else { "" } , randomize_layout ,) ,) }) ,) ; } } if let Some (current) = & current_rust_config . debug_logging { if Some (current) != debug_logging . as_ref () { return Err (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("ERROR: Setting `rust.{0}` is incompatible with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}" , "debug_logging" . replace ("_" , "-") , current_rust_config . debug_logging , if debug_logging . is_some () { "None/" } else { "" } , debug_logging ,) ,) }) ,) ; } } if let Some (current) = & current_rust_config . rpath { if Some (current) != rpath . as_ref () { return Err (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("ERROR: Setting `rust.{0}` is incompatible with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}" , "rpath" . replace ("_" , "-") , current_rust_config . rpath , if rpath . is_some () { "None/" } else { "" } , rpath ,) ,) }) ,) ; } } if let Some (current) = & current_rust_config . strip { if Some (current) != strip . as_ref () { return Err (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("ERROR: Setting `rust.{0}` is incompatible with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}" , "strip" . replace ("_" , "-") , current_rust_config . strip , if strip . is_some () { "None/" } else { "" } , strip ,) ,) }) ,) ; } } if let Some (current) = & current_rust_config . lld_mode { if Some (current) != lld_mode . as_ref () { return Err (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("ERROR: Setting `rust.{0}` is incompatible with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}" , "lld_mode" . replace ("_" , "-") , current_rust_config . lld_mode , if lld_mode . is_some () { "None/" } else { "" } , lld_mode ,) ,) }) ,) ; } } if let Some (current) = & current_rust_config . llvm_tools { if Some (current) != llvm_tools . as_ref () { return Err (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("ERROR: Setting `rust.{0}` is incompatible with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}" , "llvm_tools" . replace ("_" , "-") , current_rust_config . llvm_tools , if llvm_tools . is_some () { "None/" } else { "" } , llvm_tools ,) ,) }) ,) ; } } if let Some (current) = & current_rust_config . llvm_bitcode_linker { if Some (current) != llvm_bitcode_linker . as_ref () { return Err (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("ERROR: Setting `rust.{0}` is incompatible with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}" , "llvm_bitcode_linker" . replace ("_" , "-") , current_rust_config . llvm_bitcode_linker , if llvm_bitcode_linker . is_some () { "None/" } else { "" } , llvm_bitcode_linker ,) ,) }) ,) ; } } if let Some (current) = & current_rust_config . jemalloc { if Some (current) != jemalloc . as_ref () { return Err (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("ERROR: Setting `rust.{0}` is incompatible with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}" , "jemalloc" . replace ("_" , "-") , current_rust_config . jemalloc , if jemalloc . is_some () { "None/" } else { "" } , jemalloc ,) ,) }) ,) ; } } if let Some (current) = & current_rust_config . default_linker { if Some (current) != default_linker . as_ref () { return Err (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("ERROR: Setting `rust.{0}` is incompatible with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}" , "default_linker" . replace ("_" , "-") , current_rust_config . default_linker , if default_linker . is_some () { "None/" } else { "" } , default_linker ,) ,) }) ,) ; } } if let Some (current) = & current_rust_config . stack_protector { if Some (current) != stack_protector . as_ref () { return Err (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("ERROR: Setting `rust.{0}` is incompatible with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}" , "stack_protector" . replace ("_" , "-") , current_rust_config . stack_protector , if stack_protector . is_some () { "None/" } else { "" } , stack_protector ,) ,) }) ,) ; } } if let Some (current) = & current_rust_config . lto { if Some (current) != lto . as_ref () { return Err (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("ERROR: Setting `rust.{0}` is incompatible with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}" , "lto" . replace ("_" , "-") , current_rust_config . lto , if lto . is_some () { "None/" } else { "" } , lto ,) ,) }) ,) ; } } if let Some (current) = & current_rust_config . std_features { if Some (current) != std_features . as_ref () { return Err (:: alloc :: __export :: must_use ({ :: alloc :: fmt :: format (format_args ! ("ERROR: Setting `rust.{0}` is incompatible with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}" , "std_features" . replace ("_" , "-") , current_rust_config . std_features , if std_features . is_some () { "None/" } else { "" } , std_features ,) ,) }) ,) ; } } if let Some (current) = & current_rust_config . channel { if Some (current) != channel . as_ref () { { :: std :: io :: _print (format_args ! ("WARNING: `rust.{0}` has no effect with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}\n" , "channel" . replace ("_" , "-") , current_rust_config . channel , if channel . is_some () { "None/" } else { "" } , channel ,) ,) ; } ; } } if let Some (current) = & current_rust_config . description { if Some (current) != description . as_ref () { { :: std :: io :: _print (format_args ! ("WARNING: `rust.{0}` has no effect with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}\n" , "description" . replace ("_" , "-") , current_rust_config . description , if description . is_some () { "None/" } else { "" } , description ,) ,) ; } ; } } if let Some (current) = & current_rust_config . incremental { if Some (current) != incremental . as_ref () { { :: std :: io :: _print (format_args ! ("WARNING: `rust.{0}` has no effect with `rust.download-rustc`. Current value: {1:?}, Expected value(s): {2}{3:?}\n" , "incremental" . replace ("_" , "-") , current_rust_config . incremental , if incremental . is_some () { "None/" } else { "" } , incremental ,) ,) ; } ; } } Ok (()) }